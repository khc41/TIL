## 📅 2025-03-07
### 📖 읽은 블로그: [선착순 이벤트 시스템에서 발생가능한 동시성 문제와 해결방안 탐구(redis, kafka)](https://upcurvewave.tistory.com/482)
#### ✏️ 세 줄 요약
- 선착순 이벤트는 대량 트래픽으로 인한 동시성 문제가 발생할 수 있으며 이로 인해 초과 발급 되거나 시스템 전체가 지연될 수 있다.
- Redis INCR 연산을 활용하면 원자성을 보장하며 설정한 수량만큼 발급할 수 있다. Redis는 싱글 스레드 기반이므로 동시 요청이 직렬화된다. 
- 트래픽이 집중될 경우를 대비해 Kafka를 중간에 추가하여 쿠폰 생성 과정을 비동기적으로 처리함으로써 서버 부하를 분산할 수 있다.
#### 💡 느낀 점
- 최근에 Redis와 관련해 [inflearn 강의](https://www.inflearn.com/course/%EC%8B%A4%EC%A0%84-redis-%ED%99%9C%EC%9A%A9/dashboard)를 들었습니다. 이 강의를 들으며 Redis는 서버 환경에서 실시간 처리나 부하 분산, 원자성 보장 등에 대해서 생각했던 것보다 많이 쓰이고 있고 이를 활용해 실제 예제를 만들어보고 싶다는 생각을 했습니다. 
- 마침 실무에서 많이 발생하는 선착순 이벤트의 경우 Redis를 어떻게 해결할지 궁금해졌고, 이를 찾아보면서 Redis INCR을 이용한 원자성 보장, Set을 활용한 중복 체크 기법을 접하게 됐습니다.
- 단순한 INCR 방식뿐만 아니라 분산락이나 트랜잭션, BloomFilter 같은 다양한 기법을 활용한 실무 프로젝트를 만들어보고 싶다는 생각을 했고, 각 방법을 비교 분석하고 부하 테스트를 직접 구현해볼 예정입니다.

---

### 🎥 시청한 컨퍼런스 영상: [대규모 트랜잭션을 처리하는 배민 주문시스템 규모에 따른 진화 #우아콘2023 #우아한형제들](https://www.youtube.com/watch?v=704qQs6KoUk)
#### ✏️ 요약
배달의 민족은 매년 급격하게 증가하는 트래픽으로 인해 단일 장애 포인트, 대용량 데이터, 대규모 트랜잭션, 복잡한 이벤트 아키텍쳐 등의 문제에 직면했다. 이를 해결하기 위해 다양한 기술을 적용했다.
- 단일 장애 포인트
  - 기존의 중앙 Ruby 저장소 대신 MSA를 적용하여 각 서비스가 자체 DB를 사용하도록 변경했다.
  - MQ 기반의 이벤트 통신을 도입해 시스템 간 결합도를 낮추고 장애 영향을 최소화했다.
- 대용량 데이터
  - CQRS 패턴을 적용해 읽기 성능을 개선했다. (RDBMS -> NoSQL 역정규화 및 단일 도큐먼트 조회) 
  - 커맨드 DB는 데이터의 정합성을 보장하고 주문 이벤트 발생 시 MQ를 통해 동기화 처리를 진행했다.
- 대규모 트랜잭션
  - Write DB 샤딩을 애플리케이션 레벨에서 구현하여 처리량을 확장했다.
  - 주문 데이터의 특성을 고려해 Key Based Sharding 방식을 채택했고, AOP와 AbstractingRoutingDataSource를 이용해 구현했다.
- 복잡한 이벤트 아키텍쳐
  - 내부 (도메인 이벤트) / 외부 (서비스 로직) 이벤트를 정리해 관리 포인트를 한곳으로 집중했다.
  - 트랜잭션 아웃박스 패턴을 이용해 이벤트의 발행 실패와 서비스 실패를 격리하여 재발행 수단을 보장해줬다.
#### 💡 느낀 점
- 최근에 대규모 트래픽 처리를 집중적으로 공부하고 있는데, 트래픽 증가에 따라 발생하는 문제와 해결 과정을 구체적으로 볼 수 있어서 유익했다.
- Read Replica는 같은 종류의 DB(RDBMS)로만 구성해야 한다고 생각했는데, RDBMS와 NoSQL을 혼합하여 활용하는 방식도 있다는 걸 배웠다.
  - 특히, 이질적인 DB 간 동기화가 쉽지 않을 것 같다고 생각했다.
- DB 자체 샤딩이 아닌 애플리케이션 레벨 샤딩을 적용한 점이 인상적이었다.
- 스프링 부트에서 이벤트를 활용한 비동기 처리를 처음 접했다.
  - 찾아보니 서비스간 결합도를 낮추고 비동기적으로 처리를 통해 성능을 최적화할 수 있다는 점이 흥미로웠다.
  - 실무에서 알림 발송이나 로그 기록등에 적용하면 불필요한 의존성을 줄이고 테스트 코드 작성도 더 쉬워질 것 같다.