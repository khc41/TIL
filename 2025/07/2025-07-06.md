## 📅 2025-07-06
### 📚 읽은 개발 서적: [가상면접 사례로 배우는 대규모 시스템 설계 기초](https://product.kyobobook.co.kr/detail/S000001033116)
#### ✏️ 10장 - 알림 시스템 설계
#### 1단계 - 문제 이해 및 설계 범위 확정
- 알림의 종류, 실시간 여부, 지원 단말, 알림 생성 주체, 수신 거부, 알림 수 등을 질문해 설계 범위를 확정한다.
#### 2단계 - 개략적 설계안 제시 및 동의 구하기
- **알림 유형별 지원 방안**
    - iOS 푸시 알림: 알림 제공자, APNS, iOS 단말
    - 안드로이드 푸시 알림: 알림 제공자, FCM, 안드로이드 단말
    - SMS 메시지: 트윌리오, 넥스모 등의 제3 사업자 서비스
    - 이메일: 센드그리드, 메일침프등 상용 이메일 서비스
- **연락처 정보 수집 절차**
  - 모바일 단말 토큰, 전화번호, 이메일 주소 등의 정보를 API를 통해 수집해 데이터베이스에 저장한다.
- **알림 전송 및 수신 절차**
  - 개략적 설계안 (초안)
    - 1부터 N까지의 서비스: 마이크로서비스, 크론잡, 분산 시스템 컴포넌트 등
    - 알림 시스템: 서비스 1~N에 알림 전송을 위한 API 제공, 제3자 서비스에 전달할 알림 페이로드 생성
    - 제3자 서비스: 사용자들에게 알림 전송, 확장성/나라별 정책 등을 고려
    - iOS, 안드로이드, SMS, 이메일 단말: 알림 수신
    - **문제점**
      - SPOF, 규모 확장성, 성능 병목
    - 개략적 설계안 (개선)
      - 데이터베이스와 캐시를 알림시스템의 주 서버에서 분리
      - 알림 서버 증설하고 오토스케일링 적용
      - 메시지 큐를 이용해 컴포넌트 결합 제거
      - 별도의 작업 서버는 메시지 큐에서 알림을 꺼내 제3자 서비스에 전달
#### 3단계 - 상세 설계
- **안정성**
  - 데이터 손실 방지
    - 알림 데이터를 데이터베이스에 보관하고 재시도 메커니즘을 구현
  - 알림 중복 전송 방지
    - 중복 탐지 메커니즘 도입 및 오류 신중하게 처리
      - 이벤트 ID를 사용해 중복 탐지
- **추가로 필요한 컴포넌트 및 고려사항**
  - 알림 템플릿
  - 알림 설정
    - 사용자별로 채널과 알림 수신 여부를 설정
  - 전송률 제한
  - 재시도 방법
    - 큐를 통한 재시도
  - 푸시 알림과 보안
    - appKey와 appSecret을 사용해 보안 유지
  - 큐 모니터링
    - 큐에 쌓인 알림의 수를 보고 작업 서버 증설
  - 이벤트 추적
    - 알림 확인율, 클릭율, 실제 앱 사용으로 이어지는 비율 등을 분석
- **수정된 설계안**
  - 알림 서버에 인증과 전송률 제한 기능 추가
  - 전송 실패 대응 위한 재시도 로직 추가
  - 전송 템플릿 사용
  - 모니터링, 추적 시스템 추가

#### 💡 느낀 점
- 실제로 실무에서 fcm을 통해 푸시 알림을 구현해본 경험이 있어서 해당 주제가 반가웠다.
- 내가 했던 설계는 단순히 클라이언트 정보를 테이블에 삽입하고, 알림 수신 여부를 확인한 후, fcm을 통해 푸시 알림을 보내는 형식이였다.
- Android, iOS의 메시지 템플릿을 파악해 딥링크를 통해 알림을 보내는 방식이였다.
- 읽기 전 스스로 어떻게 하면 설계할 수 있을까 생각해봤다. 메시지 큐를 이용해 컴포넌트 결합을 낮추고, 비동기 처리를 통해서 알림을 보내는 설계를 생각했었는데 대략적으로 비슷한 것 같다.
- 메시지 큐를 통해서 구현할 때 중복처리가 핵심이라고 생각된다. 성능과 신뢰성 사이에서 트레이드 오프를 잘 선택해야할 것 같다.
- SQS를 공부했을 때, 중복 처리와 순서 보장을 제공하는 FIFO 큐, 그리고 높은 처리량을 자랑하는 Standard 큐의 차이에 대해 배운 기억이 났다. 책을 읽으며 당시 공부했던 내용이 자연스럽게 연결되었다.