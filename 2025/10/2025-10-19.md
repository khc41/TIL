## 📅 2025-10-19
### 📖 읽은 블로그: [카카오페이 온라인 결제 서비스 2.5배 성능 개선기](https://tech.kakaopay.com/post/improve-service-performance/)
#### ✏️ 세 줄 요약
- 서비스의 성장에 따라 온라인 결제 서비스의 트래픽 예상치가 300tps 정도 됐고, 그 트래픽을 견디기 위해 성능 개선을 했다.
- 다량의 COMMIT 쿼리가 Slow Query로 잡히는 현상을 발견했고, Transaction이 길었다는 것을 파악해 다양한 방법을 도입해 개선을 시도했다.
  - Redis의 비즈니스 로직을 녹여서 처리했는데, 동시성관련 이슈가 발생해 데이터 정합성이 깨졌고, lock을 추가하기 보단 서비스에 맞게끔만 사용했다.
  - OSIV 설정이 true로 설정돼있어 제거했다.
- 사용하고 있는 APM 에이전트가 코루틴에 대해 정확히 추적하지 못하는 문제를 해결하고, 모니터링을 하니 Redis에 너무 많은 접근으로 병목이 있었던 것을 확인했다. 이를 해결하기 위해 immutable한 테이블에 대해 Local Cache를 도입했다.
#### 💡 느낀 점
- 필자가 모니터링의 중요성을 느끼고 병목을 진단하고 성능 개선하는 것에 대해 모니터링을 적극적으로 사용하자고 했는데 너무 공감되는 말이었다.
- 다양한 시행착오를 거쳐서 결국에 성능 개선을 했는데, 이 부분이 인상 깊었고 항상 문제를 다양한 시각으로 보고 해결책을 찾는 것이 중요하다는 생각이 들었다.
- OSIV 설정 같은 경우, 인강에서 JPA를 배울 때 false로 설정하면 성능 개선을 할 수 있다고 봤는데, 이것을 실무에서 개선을 하는 것을 보고 확실히 성능에 이슈가 있구나 생각했고, 추상화된 프레임워크를 사용할 때는 항상 내부 동작에 집중해야한다는 것을 다시금 느꼈다.
